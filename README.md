# Data Vault 2.0 –¥–ª—è Sample Superstore

–ü—Ä–æ–µ–∫—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ Data Vault 2.0 –¥–ª—è –¥–∞—Ç–∞—Å–µ—Ç–∞ Sample Superstore, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è Greenplum –°–£–ë–î.

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Data Vault 2.0 —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä–æ–∑–Ω–∏—á–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂. 
–ó–∞ –æ—Å–Ω–æ–≤—É –≤–∑—è—Ç –¥–∞—Ç–∞—Å–µ—Ç [Kaggle Superstore](https://www.kaggle.com/datasets/vivek468/superstore-dataset-final). 

–†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ [Yandex DataLens](https://datalens.ru/preview/5fwscbmm0dfoq)

[—á–∞—Ä—Ç](https://datalens.ru/preview/5fwscbmm0dfoq-sales-superstore-dv)

![img.png](img.png)

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç:

- üìê **–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Data Vault
- üíæ **DDL —Å–∫—Ä–∏–ø—Ç—ã** - –≥–æ—Ç–æ–≤—ã–µ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é SQL —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è Greenplum
- üìä **–î–∏–∞–≥—Ä–∞–º–º—ã** - –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- üìñ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ data_vault_design.md          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
‚îú‚îÄ‚îÄ greenplum_ddl.sql              # SQL DDL –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –≤ Greenplum
‚îú‚îÄ‚îÄ data_vault_diagram.txt         # ASCII –¥–∏–∞–≥—Ä–∞–º–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ IMPLEMENTATION_SUMMARY.md      # –°–≤–æ–¥–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îî‚îÄ‚îÄ README.md                      # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Data Vault

### –•–∞–±—ã (Hubs) - –ö–ª—é—á–µ–≤—ã–µ –±–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç–∏
- **HUB_CUSTOMER** - –ö–ª–∏–µ–Ω—Ç—ã
- **HUB_PRODUCT** - –¢–æ–≤–∞—Ä—ã
- **HUB_ORDER** - –ó–∞–∫–∞–∑—ã

### –°–≤—è–∑–∏ (Links) - –û—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏
- **LINK_ORDER_CUSTOMER** - –°–≤—è–∑—å –∑–∞–∫–∞–∑–æ–≤ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏
- **LINK_ORDER_PRODUCT** - –ü–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–∞–∑–æ–≤ (–∑–∞–∫–∞–∑—ã + —Ç–æ–≤–∞—Ä—ã)

### –°–∞—Ç–µ–ª–ª–∏—Ç—ã (Satellites) - –û–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã
- **SAT_CUSTOMER** - –û—Å–Ω–æ–≤–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞ (–∏–º—è, —Å–µ–≥–º–µ–Ω—Ç)
- **SAT_CUSTOMER_LOCATION** - –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∞—Ç—Ä–∏–±—É—Ç—ã
- **SAT_PRODUCT** - –ê—Ç—Ä–∏–±—É—Ç—ã —Ç–æ–≤–∞—Ä–∞
- **SAT_ORDER** - –ê—Ç—Ä–∏–±—É—Ç—ã –∑–∞–∫–∞–∑–∞
- **SAT_ORDER_PRODUCT** - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–æ–¥–∞–∂–∏, –ø—Ä–∏–±—ã–ª—å)

## üìä –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö

**SampleSuperstore.csv** - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ä–æ–∑–Ω–∏—á–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂ —Å 21 –ø–æ–ª–µ–º:
- –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã: Row ID, Order ID, Customer ID, Product ID
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: Order Date, Ship Date
- –ö–ª–∏–µ–Ω—Ç: Customer Name, Segment, Country, Region, State, City, Postal Code
- –¢–æ–≤–∞—Ä: Product Name, Category, Sub-Category
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: Sales, Quantity, Discount, Profit, Ship Mode

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –Ω–∞ [Kaggle. About Dataset](https://www.kaggle.com/datasets/vivek468/superstore-dataset-final)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Greenplum yandex-cloud
- –î–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å –ø—Ä–∞–≤–∞–º–∏ CREATE SCHEMA

### –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

1. **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
```bash
git clone https://github.com/w3ll1ngt/shiny-adventure-data-vault.git
cd shiny-adventure-data-vault
```

2. **–í—ã–ø–æ–ª–Ω–∏—Ç—å DDL —Å–∫—Ä–∏–ø—Ç:**
```bash
psql -h <greenplum_host> -U <username> -d <database> -f greenplum_ddl.sql
```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—É—é —Å—Ö–µ–º—É
\dn dv

-- –°–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü
\dt dv.*

-- –°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π
\dv dv.*

-- –°–ø–∏—Å–æ–∫ —Ñ—É–Ω–∫—Ü–∏–π
\df dv.*
```

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö
```sql
SELECT * FROM dv.v_current_customers
WHERE customer_id = 'Home Office|United States|Great Falls|Montana|59405';
```

### –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–¥–∞–∂ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
```sql
SELECT 
    category,
    sub_category,
    SUM(sales) as total_sales,
    SUM(profit) as total_profit,
    SUM(quantity) as total_quantity
FROM dv.v_order_details
GROUP BY category, sub_category
ORDER BY total_profit DESC;
```

### –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–∫–∞–∑–∞
```sql
SELECT * FROM dv.v_order_details
WHERE order_id = 'Second Class|Henderson|42420'
ORDER BY row_id;
```

### –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ç–æ–≤–∞—Ä–∞
```sql
SELECT 
    h.product_id,
    s.product_name,
    s.category,
    s.sub_category,
    s.load_date as valid_from,
    COALESCE(s.load_end_date, '9999-12-31'::timestamp) as valid_to
FROM dv.hub_product h
JOIN dv.sat_product s ON h.hub_product_id = s.hub_product_id
WHERE h.product_id = 'FUR-BO-10001798'
ORDER BY s.load_date;
```

## ‚öôÔ∏è –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### ‚úÖ Data Vault 2.0 Compliant
- MD5 —Ö–µ—à-–∫–ª—é—á–∏ —Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π
- –ë–∏–∑–Ω–µ—Å-–∫–ª—é—á–∏ –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
- –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç—å (SCD Type 2)
- Hash diff –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è Greenplum
- `DISTRIBUTED BY` –Ω–∞ —Ö–µ—à-–∫–ª—é—á–∞—Ö –¥–ª—è MPP
- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ foreign keys –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö JOIN
- –ß–∞—Å—Ç–∏—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
- –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –±–µ–∑ ORDER BY

### ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- NULL-safe —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (COALESCE)
- –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–ª–ª–∏–∑–∏–π –≤ –∫–æ–º–ø–æ–∑–∏—Ç–Ω—ã—Ö –∫–ª—é—á–∞—Ö
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã
- Foreign key constraints –¥–ª—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏

### ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- –õ–µ–≥–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- –ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—É—â–Ω–æ—Å—Ç–µ–π
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —á–∞—Å—Ç–æ—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

**–û–±—ä–µ–∫—Ç—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
- 1 —Å—Ö–µ–º–∞ (dv)
- 2 —Ñ—É–Ω–∫—Ü–∏–∏ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- 10 —Ç–∞–±–ª–∏—Ü (3 Hubs + 2 Links + 5 Satellites)
- 15 –∏–Ω–¥–µ–∫—Å–æ–≤
- 4 –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- 40+ KB –∏—Å—Ö–æ–¥–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã
- –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ ETL

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **[data_vault_design.md](data_vault_design.md)** - –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- **[greenplum_ddl.sql](greenplum_ddl.sql)** - DDL —Å–∫—Ä–∏–ø—Ç —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
- **[data_vault_diagram.txt](data_vault_diagram.txt)** - –í–∏–∑—É–∞–ª—å–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
-  **[diagram drawio](https://app.diagrams.net/#Hw3ll1ngt%2Fshiny-adventure-data-vault%2Fmaster%2Fdv.drawio#%7B%22pageId%22%3A%22QSUUquhp0k-rUladNWHw%22%7D)** - –í–∏–∑—É–∞–ª—å–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –≤ drawio

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–¥—Ö–æ–¥–∞

1. **–ì–∏–±–∫–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º –±–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
2. **–ê—É–¥–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–∞–Ω–Ω—ã—Ö
3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è Greenplum MPP
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö
5. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –ø—Ä–æ—Å—Ç–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **–°–£–ë–î:** Greenplum (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å PostgreSQL)
- **–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è:** Data Vault 2.0
- **–Ø–∑—ã–∫:** SQL (DDL, DML)
- **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:** MD5
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** MPP (Massively Parallel Processing)

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –≤ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª—è—Ö –∫–∞–∫ —á–∞—Å—Ç—å –∫—É—Ä—Å–∞ –ø–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Ö—Ä–∞–Ω–∏–ª–∏—â –¥–∞–Ω–Ω—ã—Ö.

## üë§ –ê–≤—Ç–æ—Ä

[@w3ll1ngt](https://github.com/w3ll1ngt) & GitHub Copilot 

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ Data Vault 2.0 –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã—Ö –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ Greenplum –°–£–ë–î.